<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="Language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="//{#DOMAIN#}/static/app.css?{#STATICVERSION#}" />
    <title>SphereCube</title>
</head>

<body>

    <div id="workspace">
        <card cid="1cc5e6bc-5f40-11eb-8d14-02004c4f4f50"></card>
        <card cid="ac7e17c1-5f40-11eb-8d14-02004c4f4f50"></card>
    </div>

    <div id="footer">
        <address>SphereCube | on {#DOMAIN#} <small>{#STATICVERSION#}</small></address>
    </div>

    <script type="text/javascript">
        const DOMAIN = '{#DOMAIN#}';
        const VERSION = '{#STATICVERSION#}';
        const MODELS = {
            'Card': 'card',
            'MetaTS': 'meta-ts',
            'MetaUser': 'meta-user'
        };
        const LoadedMODELS = {};
        const TYPES = {
            'text': 'type-simple-text'
        };
        const LoadedTYPES = {};
        var APP;

        function InitAPP() {
            console.log('Init APP');
            APP = Vue.createApp({});
            for (const [k, v] of Object.entries(LoadedMODELS)) {
                APP.component(k, v);
            };
            for (const [k, v] of Object.entries(LoadedTYPES)) {
                APP.component(k, v);
            };
            console.log('Mount APP');
            APP.mount('#workspace');
        }
    </script>
    <script type="text/javascript" src="//{#DOMAIN#}/static/basket.js?{#STATICVERSION#}"></script>
    <script type="text/javascript" src="//{#DOMAIN#}/static/vue.js?{#STATICVERSION#}"></script>
    <script type="text/javascript" src="//{#DOMAIN#}/static/axios.js?{#STATICVERSION#}"></script>
    <script type="text/javascript" src="//{#DOMAIN#}/static/moment.js?{#STATICVERSION#}"></script>
    <script type="text/javascript">
        // TODO: splash
        var APPrequires = [{
            url: '/static/app.js',
            unique: '{#STATICVERSION#}'
        }];
        for (const [k, v] of Object.entries(MODELS)) {
            APPrequires.push({
                url: '/static/models/' + v + '.js',
                unique: '{#STATICVERSION#}'
            });
        };
        for (const [k, v] of Object.entries(TYPES)) {
            APPrequires.push({
                url: '/static/types/' + v + '.js',
                unique: '{#STATICVERSION#}'
            });
        };
        console.log('Loading start...');
        basket
            .require(...APPrequires)
            .then(() => {
                // TODO: unsplash
                console.log('Loading complete');
                InitAPP();
            }),
            function(error) {
                // TODO: show user-error
                console.log('Basket', error);
            };
    </script>
</body>

</html>